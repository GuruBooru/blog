# 난수

#### C++ 에서의 난수

* rand\(\)

  * 0 ~ 32767 까지 정수 표현 가능
  * srand\(\) : 난수 생성에 필요한 시드값 설정

  ```cpp
  int a = rand();
  ```

  해당 코드를 디스 어셈블리로 확인해보면아래와 같은 코드를 확인할 수 있다.

  ```cpp
  int a = rand();  
  call        dword ptr [__imp__rand (037B170h)]   
  mov         dword ptr [a],eax
  ```

  rand 함수 내부에서  \_\_imp\_\_rand\(\)  함수가 호출되는 것을 볼 수 있다.

  ```cpp
  call        00007FFD868B2FE0  
  imul        ecx,dword ptr [rax+28h],343FDh  
  add         ecx,269EC3h  
  mov         dword ptr [rax+28h],ecx  
  shr         ecx,10h  
  and         ecx,7FFFh  
  mov         eax,ecx  
  add         rsp,28h 
  ```

  \_\_imp\_\_rand\(\) 내부에서는 난수 측정을 위해 특정 연산을 수행하는 함수로, 첫 call 부분을 더 파고들면 복잡한 연산을 수행한다는 것을 알 수 있다.

* 즉, rand 함수는 완벽한 난수를 생성하는 것이 아니라, 고정된 규칙을 따라 값을 순서대로 뽑아내는 것이라고 할 수 있다.
* 그렇기 때문에 srand를 통해서 시드값을 바꿔주는 것으로 사용자가 난수라고 생각할 수 있게 만들 수 있으며, 시드값을 바꾸기 위해 주로 time 함수를 사용하여 시드값을 변경한다.



#### 게임에서의 난수

* 게임에서 난수를 사용한다면, 어떤 랜덤한 결과를 위해서 사용하게 될 것이다.
* 주로 가챠 종류에서 이런 기능을 원한다는 것을 알 수 있다.

1. 각 요소 별 가중치를 더해 총량을 만들고, 총량을 기준으로 연산하는 방식
   * 난수를 써서 구현하는 방식 
2. 한 번 해당 값이 나오면 해당 값이 다시는 나오지 않는 방식
   * 나온 난수를 저장하여 매번 검색하는 방식 → 점점 성능이 떨어지는 단점
   * 결과값을 미리 산출하여 난수를 사용하여 섞어 놓은 후 하나씩 뽑아주는 방식
   * 각각의 항목이 나올 경우 해당 항목의 가중치를 줄이는 방식



#### rand 함수의 한계

* 현재 C++에서 사용하는 rand 함수는 최댓값이 32767이라고 고정되어 있다.
* 이런 값이 부족하다고 생각할 경우, 범위를 늘릴 수 있다고 생각해야 한다.
* 가장 간단하게 생각할 수 있는 방식은 난수들을 구한 후, 비트 연산을 통해 합치면 내가 원하는 범위를 구할 수 있다.






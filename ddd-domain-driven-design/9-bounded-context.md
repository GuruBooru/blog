# 9장 도메인 모델과 Bounded Context

## 도메인 모델과 경계

* 처음 도메인 모델을 만들 때 빠지기 쉬운 함정이 도메인을 완벽하게 표현하는 단일 모델을 만드려고 하는 것
  * 한 도메인은 여러 하위 도메인으로 구분
  * 한 개의 모델로 여러 하위 도메인을 모두 표현하려고 하면 하위 도메인에 맞지 않는 모델을 만들게 됨
    * 하위 도메인마다 사용하는 용어가 다르고, 같은 대상이라도 지칭하는 용어가 다를 수 있기 떄문
  * 즉, 하위 도메인마다 모델을 만들어 사용해야 한다.

## BOUNDED CONTEXT

* 모델의 경계를 결정하며, 한 개의 Bounded Context는 논리적으로 한 개의 모델을 갖는다
* Bounded Context는 용어를 기준으로 구분
* 이상적으로 하위 도메인과 Bounded Context가 1대1 관계를 가지면 좋지만, 한 도메인에 2개의 Bounded Context가 존재할 수도 있고, 용어를 명확하게 하지 못해 두 하위 도메인에 한 Bounded Context가 존재할 수도 있음
  * 여러 하위 도메인을 한 Bounded Context에서 개발할 경우, 하위 도메인의 모델이 뒤섞이지 않도록 하는 것
  * 전체 하위 도메인을 위한 단일 모델을 만들고 싶은 유혹에 빠지기 쉽지만, 결과적으로 **개별 하위 도메인을 제대로 반영하지 못해 기능 확장이 어렵게 되는 경우가 발생**
  * **한 개의 Bounded Context에서 여러 하위 도메인을 포함하더라도, 하위 도메인마다 구분되는 패키지를 갖도록 구현**해야 하위 도메인을 위한 모델이 서로 뒤섞이지 않아 하위 도메인마다 Bounded Context를 갖는 효과를 발휘

## BOUNDED CONTEXT 구현

* Bounded Context가 도메인 모델만 포함하는 것이 아닌,  
  **도메인 기능을 사용자에게 제공하는 표현 영역, 응용 서비스, 인프라 영역 등을 모두 포함**

  
  **도메인 모델의 데이터 구조가 바뀌면 DB 테이블 스키마도 변경해야 하므로, 해당 테이블도 Bounded Context에 포함**

* 모든 Bounded Context를 반드시 도메인 주도로 개발할 필요는 없음
  * 도메인 기능 자체가 단순하다면 서비스-DAO로 구성된 CRUD 방식을 사용해도 무관
  * 한 Bounded Context에서 두 방식을 혼합하여 사용할 수도 있음\(대표적으로 CQRS\) 
* 각 Bounded Context는 서로 다른 구현 기술을 사용할 수도 있음
* Bounded Context가 반드시 사용자에게 보여지는 UI를 가져야 하는 것은 아님

## BOUNDED CONTEXT 간 통합

* 하위 도메인에서 새로운 기능을 도입하면서 기존과는 별개의 Bounded Context가 만들어질 경우, 하위 도메인에는 기존의 Bounded Context와 새로운 기능을 위한 Bounded Context가 생긴다.
* 이 두 Bounded Context가 관련된 Bounded Context를 개발하게 된다면, Bounded Context 간 통합이 발생하게 된다.
* 한 쪽의 Bounded Context를 다른 쪽의 Bounded Context로 변환하는 작업을 뜻한다고 이해 이 과정에서 변환 작업이 복잡할 경우 변환 처리를 위한 별도의 클래스 작성, 해당 클래스에서 처리하도록 수행할 수 있음 
* REST API를 사용하는 방식

  * 직접 통합하는 방식
  * Infra Structure 단에서 데이터를 받아 도메인 인터페이스에서 해당 데이터를 가공하여 통합

* 메시지 큐 사용하는 방식
  * 간접 통합 방식
  * 각 Bounded Context 사이에 메시지 큐를 추가하여 비동기로 메시지 처리

## BOUNDED CONTEXT 간 관계

* Bounded Context 간 다양한 방식의 관계가 존재
  1. 한쪽에서 API 제공, 다른 한쪽에서 API 호출

     * API를 사용하는 쪽에서 API를 제공하는 쪽에 의존
     * 보통 상류 컴포넌트에서 하류 컴포넌트가 사용할 수 있는 프로토콜 정의
     * 공개 호스트 서비스
     * 하류 컴포넌트에서 상류 서비스의 모델이 자신의 모델에 영향을 주지 않도록 보호하는 완충지대를 만들어 사용

  2. 두 Bounded Context가 같은 모델을 공유

     * 두 Bounded Context가 공유하는 모델을 `공유 커널`이라고 부름
     * 중복을 줄여주는 장점
     * 한쪽에서 임의로 모델을 변경할 수 없고, 밀접한 관계 유지

  3. 독립 방식
     * 서로 통합하지 않는 방식
     * 두 Bounded Context 간 통합은 수동으로 처리
     * 규모가 커질수록 한계가 있음

## 컨텍스트 맵

* 개별 Bounded Context에 매몰되어 전체를 보지 못하는 상황을 방지
* Bounded Context 간 관계를 표시
* Bounded Context 영역에 주요 애그리거트를 함께 표시하면 모델에 대한 관게가 더 명확하게 드러남
* 시스템의 전체 구조를 보여주어 하위 도메인과 일치하지 않는 Bounded Context를 찾아 도메인에 맞게 조절 핵심 도메인을 위해 조직 역량을 어떤 Bounded Context에 집중할지 파악하는데 도움을 줌
* 컨텍스트 맵을 그리는 규칙은 따로 없으며, 각 컨텍스트의 관계를 이해할 수 있으면 된다.


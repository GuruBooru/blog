# 2장 리팩토링 개론

## 리팩토링

* 리팩토링의 2가지 정의

> 1. 겉으로 드러나는 기능은 그대로 둔 채, 알아보기 쉽고, 수정하기 간편하게 소프트웨어 내부를 수정하는 작업
> 2. 리팩토링 기법을 연달아 적용해서 겉으로 드러나는 기능은 그대로 둔 채 소프트웨어 구조를 변경한다.

* 리팩토링 != 코드 정리 작업 리팩토링으로 인해 코드 효율성이 높아지고, 구조도 체계화된다. → 단순한 코드 정리보다 포괄적

> 성능 최적화  
> 리팩토링과는 다르게 성능을 위해서 수행하기 때문에 코드가 더 어려워지는 경우가 더 많다.  
> 함수를 호출하는 것 역시 성능에 조금이나마 영향을 주기 때문에 리팩토링과는 반대 방향으로 진행되는 경우가 많을 것이라 생각된다.

## 리팩토링의 필요성

### 설계의 개선

* 리팩토링을 수행하는 것으로 구조가 산만해진 코드를 정리
  * 대표적으로 중복 코드를 없애는 것으로 간단하게 관리할 수 있게 된다. 
* 소프트웨어를 이해하기 쉬워짐
  * 흔히 말하는 `돌아만 가는 코드` 에 대해서 리팩토링을 수행하게 되면서 코드에 의도한 바를 정확하게 전달할 수 있게 된다. 
* 버그를 찾기 쉬워짐
  * 코드가 한 눈에 들어오게 되면서 버그가 발생할 만한 부분들이 보이게 되므로, 버그를 찾기 수월해진다. 
* 프로그래밍 속도가 빨라진다.
  * 이 책에서는 코드를 신속하게 개발할 수 있게 만들어주는 것을 요점으로 설명하고 있다.
  * 깔끔하게 정리된 코드에서는 새로운 기능을 추가하거나, 기능을 수정하는 데 있어 그렇지 않은 코드보다 변경의 전파가 일어날 확률이 적기 때문에 이렇게 말한 것이라 생각한다.

### 리팩토링이 필요한 때

1. 같은 작업이 계속해서 나타날 경우
   * 이 경우 같은 코드가 반복해서 나타난다고 볼 수 있기 때문에 중복 코드를 없애는 데 효과적
2. 기능을 추가할 때
   * 코드를 이해하기 쉽게 만들기 위해 수행
   * 또는 설계가 지저분해서 어떤 기능을 추가하기 어려운 경우 리팩토링을 먼저 수행하고 기능 추가를 수행하는 것을 생각해 볼 수 있다.
3. 버그를 수정
   * 기능을 수정할 때와 비슷한 맥락에서 수행
4. 코드 검수
   * 자기의 코드는 자신이 볼 때는 쉬울 수 있어도, 다른 사람이 볼 때는 어렵게 느껴지는 경우가 많다.
   * 코드 검수를 통해 이러한 부분들을 알게 되고, 다른 사람들이 보기에도 쉽게 느낄 수 있도록 고치는 것

> 리팩토링의 효용성
>
> * 프로그램은 다음 4가지 상황에서 수정하기 어려워짐
>   1. 코드가 더러울 때
>   2. 중복 로직이 많은 경우
>   3. 추가 기능이 들어갈 때
>   4. 조건문이 복잡할 경우 
> * 따라서 위에 경우가 최대한 나타나지 않게 코드를 작성하는 것이 좋다.



### 팀장에게 말 꺼내는 방법

* ....팀장님이 허락한다면 진행하고 허락하지 않으면 몰래 진행하라고.... 스터디에서 사용하는 책은 1판이여서 이런 내용이 있었지만,  2판에서는 삭제되었다고 알려주었다.

## 리팩토링 관련 문제

### 데이터베이스

* 비즈니스 애플리케이션들이 데이터베이스 스키마와 강력하게 결합
  * 해당 문제는 객체 모델과 데이터베이스 모델 사이에 별도의 소프트웨어 계층을 마련 해당 계층만 수정한다면 두 모델의 변경 사항을 유지할 수 있음 
* 데이터 이전의 문제도 있음
* 객체 데이터베이스의 경우 자동 마이그레이션을 활용하여 개발을 수월하게 진행할 수도 있고, 직접 마이그레이션을 구현하여 버그 발생 위험을 줄일 수도 있음

### 인터페이스 변경

* 리팩토링의 단점으로 상당수의 인터페이스를 건드리기 때문에  다른 파트의 코드에서 사용하는 인터페이스를 리팩토링할 경우, 문제가 복잡해진다.
* 위와 같은 경우의 인터페이스를 배포 인터페이스라고 지칭했는데, 배포 인터페이스를 건드릴 경우, 기존의 인터페이스와 새 인터페이스를 유지하는 것으로 리팩토링을 진행할 수 있다고 설명하고 있다.

  > 물론 일정 기간은 사용하지 않는 메소드가 남기 때문에 코드가 복잡해질 수는 있다.
  >
  > 또한 꼭 필요하지 않은 경우, 인터페이스를 배포 타입으로 만들지 않는 것으로 문제를 해결할 수 있음

### 리팩토링을 어렵게 하는 설계를 수정하는 일

* 설계 자체의 오류, 설계에 대한 결정이 개발 중간에 바뀌는 경우, 수정이 어려운 민감한 사항에서도 리팩토리 공정은 가능
* 새로운 기능을 추가할 시점에 리팩토링을 통하여 구조를 변경하는 등 시간을 들여 천천히 교체할 수 있음

### 리팩토링하면 안되는 상황

* 코드를 처음부터 새로 작성해야 할 때
  * 코드가 엄청 지저분해서 새로 작성하는 경우가 더 빠를 때 수행
  * 하지만, 해당 상황에 대해서 판단을 내리기 어렵고, 기준 또한 없음
  * 거대 소프트웨어를 강력한 캡슐화를 통해 여러 컴포넌트로 나누어 각 컴포넌트 별로 리팩토링을 수행하는 것으로 부담을 덜 수 있음
* 납기가 임박했을 경우
  * 리팩토링에는 너무 복잡한 코드로 유지보수와 확장을 위한 별도 비용이 따라온다.
  * 대출을 원금과 이자를 같이 갚 듯 부담이 되지 않는 선에서 리팩토링을 수행해야 함

## 리팩토링과 설계

* 리팩토링은 설계를 보완하는 특수한 역할
* 사전 설계가 기술 도면을 작성하는 것이고, 코드가 건설 작업이라 했을 때, 리팩토링을 적용한다면, 사전 설계는 큰 방향을 잡는 작업이고, 리팩토링을 통해 방향을 조금씩 수정해 나간다고 생각하면 될 것
* 리팩토링을 중점으로 작업을 할 경우, 설계가 단순해진다는 장점이 있음

## 리팩토링과 성능

* 설계의 순수성을 강조하거나, 하드웨어를 믿고 성능을 무시하는 것은 이론 상에서만 가능한 부분
* 성능은 리팩토링을 진행한 후, 소프트웨어를 튜닝 가능하게 만들어 튜닝하는 것으로 해결해야 함
* 빠른 소프트웨어를 작성할 수 있는 3가지 방법
  1. 실시간 시스템에 주로 사용되는 시간 분배 활용
     * 예산을 할당하고, 그 예산을 초과하지 않게 개발하는 방법
     * 철저하게 성능 시간을 측정하여 계산하는 것이 중요
  2. 성능에 꾸준한 관심을 갖기
     * 거의 실행될 일 없는 코드와 많이 수행되는 코드 중 거의 실행될 일 없는 코드를 최적화한다고 영향이 크지 않음
     * 많이 수행되는 코드 위주로 최적화를 수행하여 최적화 효율을 높이는 것이 중요
  3. 기능을 쪼개서 최적화 수행




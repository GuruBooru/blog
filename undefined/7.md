# 7장 객체 간의 기능 이동

* 객체 설계에서 `기능을 어디에 넣을지 판단하는 것`은 가장 중요한 일 중 하나
* 기능을 넣을 적절한 위치를 찾는 문제는 `함수 이동`과 `변수 이동`을 실시해서 기능을 옮기면 해결 → `변수 이동` 후 `함수 이동`을 실시하는 것이 수월 
* 클래스가 방대해지는 원인은 대개 기능이 너무 많기 때문 → `클래스 추출`을 통해 일부 분리 
* 클래스에 기능이 너무 적어질 경우 → `클래스 내용 직접 삽입`을 통한 클래스 병합 
* 대리 클래스가 사용 중일 경우 → `대리 객체 은폐`   대리 클래스를 은폐 시 해당 클래스를 소유한 클래스의 인터페이스가 변경될 경우, → `과잉 중개 함수 제거` 
* 특이 케이스
  * 외래 클래스에 함수 추가
  * 국소적 상속확장 클래스 

## 함수 옮기기

### 동기

* 함수가 자신이 속한 클래스보다 다른 클래스의 기능을 더 많이 이용할 경우, 해당 함수를 제일 많이 사용하는 클래스 안에서 비슷한 내용의 새 함수 작성, 기존 함수는 대리 함수로 전환 혹은 삭제 
* 일부 속성을 옮긴 후 실행하는 것이 좋음\(변수 이동\)
* 판단이 쉽지 않을 경우, 다른 함수를 먼저 살펴보고 알아서 판단\(....?\)

### 방법

1. 원본 클래스에 정의되어 있는 원본 함수에 사용된 모든 기능 검사 → 해당 기능들을 전부 옮겨야 할지 판단
   * 옮길 함수에만 사용되는 기능도 함수와 같이 옮겨야 함
   * 다른 함수에서도 사용된다면 고려 
2. 원본 클래스의 하위 클래스와 상위 클래스에서 해당 함수에 대한 선언 찾기

   * 다른 선언이 있다면 대상 클래스에도 재정의를 넣을 수 있는 경우에만 옮길지 말지 판단

3. 대상 클래스 내부에 함수 선언, 원본 함수 복사, 대상 클래스에서 잘 수행하도록 수정
   * 함수가 원본 객체를 참조할 경우, 원본 객체를 참조할 방법 찾기
   * 예외처리 코드를 어느 곳에서 수행할지 결정
4. 원본 객체에서 대상 객체를 참조할 방법 찾기
5. 원본 함수를 위임 함수로 전환
6. 컴파일 & 테스트 후 원본 함수를 삭제하거나 위임 함수로 사용 원본 함수 삭제 시 기존의 참조를 대상 함수의 참조로 수정

## 변수 옮기기

* 어떤 필드가 자신이 속한 클래스보다 다른 클래스에서 더 많이 사용되는 경우,  대상 클래스 안에 새 필드를 선언하고 필드 참조 부분을 전부 새 필드 참조로 수정

## 클래스 추출

### 동기

* 두 클래스가 처리해야 할 기능이 한 클래스에 들어 있는 경우,  새 클래스를 만들고 기존 클래스의 관련 필드와 메소드를 새 클래스로 옮김
* DDD에서 도메인 서비스를 만드는 동기와 유사 \(DDD 7장 참조\) [https://app.gitbook.com/@123gudehsdl/s/study/~/drafts/-MbZgHXMbLtGVCWlIWml/ddd-domain-driven-design/7](https://app.gitbook.com/@123gudehsdl/s/study/~/drafts/-MbZgHXMbLtGVCWlIWml/ddd-domain-driven-design/7) 
* 주로 함께 변화하거나, 서로 유난히 의존적인 부분을 클래스로 떼어내기 좋음

### 방법

1. 클래스의 기능 분리 방법 결정
2. 분리한 기능을 넣을 새 클래스 작성
3. 원본 클래스에서 새 클래스로의 링크 만들기
4. 옮길 변수마다 변수 이동 적용
5. 함수 이동을 통해 원본 함수를 새 클래스로 이동
6. 각 클래스를 검사하여 인터페이스 줄이기 양방향 링크가 있을 경우, 단방향으로 바꿀 수 있는지 확인
7. 새 클래스를 접근할 수 있게 할지 결정
   * 여러 곳에서 접근 가능할 경우, 왜곡의 위험 고려하여 결정

* 두 결과 클래스에 따로 락을 걸 수 있기 때문에 병렬 수행에 용이
* 두 객체에 동시에 락을 걸 경우, 트랜잭션과 다른 종류의 공유 락 영역으로 넘어감 → 해당 영역은 얻는 것에 비해 많은 작업을 요구하는 경우가 많다.

## 클래스 인라인하기

* 클래스에 기능이 너무 적을 경우, 해당 클래스의 모든 기능을 다른 클래스로 합쳐 넣고 원래 클래스는 삭제

## 위임 숨기기

### 동기

* 클라이언트가 객체의 대리 클래스를 호출할 경우, 대리 클래스를 감추는 함수를 서버에 작성

## 중개자 제거하기

## 외래 클래스에 함수 추가

## 국소적 확장 클래스 사용

